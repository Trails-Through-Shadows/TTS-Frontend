<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="icon" href="src/favicon.ico" type="image/x-icon">
    <title>Trails Through Shadows</title>
</head>

<body class="bg-image" style="background-image: url('src/background-wood.jpg'); background-size: cover; background-position: center center; background-attachment: fixed; overflow: hidden">

<div class="navbar" style="background: url('src/navbar-background-smol.jpg') center/cover no-repeat; height: 75px; z-index: 1046">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Trails Through Shadows</a>
        <button class="btn btn-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#mapCanvas">Map</button>
    </div>
</div>

<div class="container-fluid h-100">
    <div class="row h-100">
        <div class="col-md-6" id="characterColumn" style="height: 100vh; overflow-y: auto;">
        </div>
    </div>
</div>

<div class="offcanvas offcanvas-end" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="mapCanvas" data-bs-show="true" style="width: 50%">
    <canvas id="hexGridView" style="margin-top: 75px"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="hexgridmap.js"></script>
<script>
    const canvasRoot = document.getElementById('hexGridView');
    const canvas = new HexGridMap.Canvas(canvasRoot, null);
    let context = canvas.getContext('2d');


    const textureImage = new Image();
    textureImage.src = 'src/map-texture-smol-light.jpg';

    const borderImage = new Image();
    borderImage.src = 'src/map-texture-smol.jpg';

    const hexGrid = new HexGridMap.HexGrid(canvas, 45, []);
    hexGrid.readData('https://api.tts-game.fun/parts/11', textureImage, borderImage);

    canvas.setBackgroundImage('src/map-background.jpg', () => {
        canvas.clear();
        hexGrid.draw();
    });

    canvas.addOnSizeListener(() => {
        canvas.clear();
        hexGrid.draw();
    });

    fetch('https://api.tts-game.fun/playerdata/characters?idAdventure=1')
        .then(response => response.json())
        .then(data => {
            data.forEach(character => {
                addCharacterCard(character);
            });
        })
        .catch(error => console.error('Error fetching data:', error));

    function addCharacterCard(character) {
        const characterColumn = document.getElementById('characterColumn');

        const card = document.createElement('div');
        card.classList.add('card', 'mb-3');

        const row = document.createElement('div');
        row.classList.add('row', 'g-0');

        const imageColumn = document.createElement('div');
        imageColumn.classList.add('col-md-2');

        const image = document.createElement('img');
        image.src = `src/classes/${character.clazz.name}.png`;
        image.classList.add('card-img');
        image.alt = `${name} Image`;

        image.style.width = '100px';
        image.style.height = '100px';

        imageColumn.appendChild(image);

        const textColumn = document.createElement('div');
        textColumn.classList.add('col-md-8');

        const cardBody = document.createElement('div');
        cardBody.classList.add('card-body');

        const title = document.createElement('h5');
        title.classList.add('card-title');
        title.textContent = name;

        const text = document.createElement('p');
        text.classList.add('card-text');
        text.textContent = `Character: ${character.name}, Player: ${character.playerName}`;

        cardBody.appendChild(title);
        cardBody.appendChild(text);

        textColumn.appendChild(cardBody);

        row.appendChild(imageColumn);
        row.appendChild(textColumn);

        card.appendChild(row);

        characterColumn.appendChild(card);
    }

    document.addEventListener('DOMContentLoaded', function() {
        var mapCanvas = new bootstrap.Offcanvas(document.getElementById('mapCanvas'));
        mapCanvas.show();
    });
</script>

</body>
</html>
